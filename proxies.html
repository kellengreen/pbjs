<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>pb.js</title>
</head>
<body>
<script src="bin/reflect.js"></script>
<script>
    'use strict';
    var pb = {};

    pb.proxy = {

        utils: Symbol('Proxy utility properties'),

        handler: {

            get: function(obj, key) {
                console.log('GET: ' + key);
                return obj[key];
            },

            set: function(obj, key, val) {

                console.log('SET: ' + key + ' = ' + val);

                if (typeof val === 'object') {
                    val = pb.proxy.create(val);
                    val[pb.proxy.utils].path = (obj[pb.proxy.utils].path ? obj[pb.proxy.utils].path + '.' : '') + key;
                }

                return obj[key] = val;
            }
        },

        create: function(obj) {

            Object.defineProperty(obj, pb.proxy.utils, {
                value: {
                    path: '',
                    getByPath: function (path) {

                        var val = this;
                        var keys = path.split('.');

                        for (var key in keys) {
                            val = val.hasOwnProperty(key);
                            if (obj !== undefined) {
                                return undefined;
                            }
                        }
                        return val;

                    },
                    setByPath: function (path, val) {

                    },
                    setByPathSilent: function (path, val) {

                    }
                }
            });

            return new Proxy(obj, pb.proxy.handler);
        }
    };

    var a = pb.proxy.create({});
    a.foo = 'bar';
    console.dir(a.foo);

</script>
</body>
</html>
