<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>pb.js</title>
</head>
<body>
<script src="bin/reflect.js"></script>
<script>
    'use strict';
    var pb = {};

    pb.handler = {

        get: function(obj, key) {
            return obj.$.hasOwnProperty(key) ? obj.$[key] : obj[key];
        },

        set: function(obj, key, val) {

            if (typeof val === 'object') {
                var proxy = pb.createProxy(val);
                proxy.path = (obj.path ? obj.path + '.' : '') + key;
            }

            return obj.$[key] = proxy;

        }
    };

    pb.proxy = {
        path: Symbol('Proxy Path'),
        create: function(obj) {
            Object.defineProperty(obj, '$', {
                writable: true,
                value: new obj.constructor()
            });

            Object.defineProperty(obj, '_path', {
                writable: true,
                value: ''
            });

            Object.defineProperty(obj, '_get', {
                value: function(path) {

                    var val = this;
                    var keys = path.split('.');

                    for (var key in keys) {
                        val = val.hasOwnProperty(key);
                        if (obj !== undefined) {
                            return undefined;
                        }
                    }
                    return val;
                }
            });

            Object.defineProperty(obj, '_set', {
                value: function(key, val) {

                }
            });

            Object.defineProperty(obj, '_setSilent', {
                value: function(key, val) {

                }
            });

            return new Proxy(obj, h);

        }
    };


    var a = pb.createProxy({});
    a.b = {};
    a.foo = 'bar';
    a.b.c = [];
    console.dir(a);
</script>
</body>
</html>
